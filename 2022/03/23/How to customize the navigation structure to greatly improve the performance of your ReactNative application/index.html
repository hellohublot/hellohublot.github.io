<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"hellohublot.github.io","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"right","display":"hide","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="Where is the performance bottleneck of react-navigationWe can know that the best animation performance of ReactNative is LayoutAnimation UIView animation, The best gesture performance is to use Native">
<meta property="og:type" content="article">
<meta property="og:title" content="How to customize the navigation structure to greatly improve the performance of your ReactNative application">
<meta property="og:url" content="https://hellohublot.github.io/2022/03/23/How%20to%20customize%20the%20navigation%20structure%20to%20greatly%20improve%20the%20performance%20of%20your%20ReactNative%20application/index.html">
<meta property="og:site_name" content="时光荏苒">
<meta property="og:description" content="Where is the performance bottleneck of react-navigationWe can know that the best animation performance of ReactNative is LayoutAnimation UIView animation, The best gesture performance is to use Native">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2022-03-23T08:49:14.000Z">
<meta property="article:modified_time" content="2023-02-25T08:52:56.537Z">
<meta property="article:author" content="hublot@aliyun.com">
<meta property="article:tag" content="ReactNative">
<meta property="article:tag" content="Performance">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://hellohublot.github.io/2022/03/23/How%20to%20customize%20the%20navigation%20structure%20to%20greatly%20improve%20the%20performance%20of%20your%20ReactNative%20application/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>How to customize the navigation structure to greatly improve the performance of your ReactNative application | 时光荏苒</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">时光荏苒</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://hellohublot.github.io/2022/03/23/How%20to%20customize%20the%20navigation%20structure%20to%20greatly%20improve%20the%20performance%20of%20your%20ReactNative%20application/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="hublot@aliyun.com">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="时光荏苒">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          How to customize the navigation structure to greatly improve the performance of your ReactNative application
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-03-23 16:49:14" itemprop="dateCreated datePublished" datetime="2022-03-23T16:49:14+08:00">2022-03-23</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-02-25 16:52:56" itemprop="dateModified" datetime="2023-02-25T16:52:56+08:00">2023-02-25</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="Where-is-the-performance-bottleneck-of-react-navigation"><a href="#Where-is-the-performance-bottleneck-of-react-navigation" class="headerlink" title="Where is the performance bottleneck of react-navigation"></a>Where is the performance bottleneck of react-navigation</h2><p>We can know that the best animation performance of ReactNative is LayoutAnimation UIView animation, The best gesture performance is to use NativeEvent. These two solutions point to one direction, that is, to solve the performance problem of ReactNative. We cannot let busy JS threads participate in these calls. However, react-navigation from onPress to navigation.push There are JS calls, so our task today is to customize a navigation architecture to greatly improve the performance of our ReactNative application</p>
<h2 id="Encapsulate-NavigationController"><a href="#Encapsulate-NavigationController" class="headerlink" title="Encapsulate NavigationController"></a>Encapsulate NavigationController</h2><p>Starting from the animation, we need to use the UIView process animation that comes with Native. Then the iOS platform already has a UINavigationController library. We only need to create a UINavigationController on the Android platform.</p>
<ul>
<li>We need to handle the hiding of the TabBar</li>
<li>We need to hide the Controller that has been covered by the top page to save memory</li>
<li>And we need to handle viewDidAppear and viewDidDisappear lifecycle</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// NavigationController</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">popToViewController</span><span class="params">(<span class="keyword">final</span> HTRouteController controller, Boolean animated)</span> </span>&#123;</span><br><span class="line">     <span class="keyword">if</span> (childControllerList. size() &lt;= <span class="number">1</span>) &#123;</span><br><span class="line">         <span class="keyword">return</span>;</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">if</span> (<span class="keyword">this</span>. lock) &#123;</span><br><span class="line">         <span class="keyword">return</span>;</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">this</span>. lock = <span class="keyword">true</span>;</span><br><span class="line">     <span class="keyword">final</span> <span class="keyword">int</span> index = childControllerList. indexOf(controller);</span><br><span class="line">     <span class="keyword">final</span> HTRouteController animatedController = childControllerList. get(childControllerList. size() - <span class="number">1</span>);</span><br><span class="line">     <span class="keyword">if</span> (index == <span class="number">0</span>) &#123;</span><br><span class="line">         HTRouteTabBarController tabBarController = HTRouteGlobal.nextController(getView(), HTRouteTabBarController.class);</span><br><span class="line">         <span class="keyword">if</span> (tabBarController != <span class="keyword">null</span>) &#123;</span><br><span class="line">             tabBarController. reloadShowTabBar(<span class="keyword">true</span>);</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;</span><br><span class="line">     controller.getView().setVisibility(View.VISIBLE);</span><br><span class="line">     translateAnimation(animatedController, animatedController.getView(), <span class="keyword">false</span>, animated, <span class="keyword">new</span> Callback() &#123;</span><br><span class="line">         <span class="meta">@Override</span></span><br><span class="line">         <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">invoke</span><span class="params">(Object... args)</span> </span>&#123;</span><br><span class="line">             controller. viewDidAppear();</span><br><span class="line">             animatedController. viewDidDisappear();</span><br><span class="line">             <span class="keyword">int</span> size = childControllerList. size();</span><br><span class="line">             List&lt;HTRouteController&gt; willRemoveControllerList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">             <span class="keyword">for</span> (<span class="keyword">int</span> i = index + <span class="number">1</span>; i &lt; size; i ++) &#123;</span><br><span class="line">                 HTRouteController removeController = childControllerList. get(i);</span><br><span class="line">                 willRemoveControllerList. add(removeController);</span><br><span class="line">             &#125;</span><br><span class="line">             <span class="keyword">for</span> (HTRouteController removeController: willRemoveControllerList) &#123;</span><br><span class="line">                 removeChildController(removeController);</span><br><span class="line">             &#125;</span><br><span class="line">             lock = <span class="keyword">false</span>;</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Package-TabBar"><a href="#Package-TabBar" class="headerlink" title="Package TabBar"></a>Package TabBar</h2><p>From gesture analysis, we need to avoid JS.onPress, so we use the package of UITabBarController and UITabBar on the iOS platform. We only need to create a UITabBar and UITabBarController on the Android platform.</p>
<ul>
<li>Due to the diversity of TabBar, we just encapsulate a common example, and other projects can inherit and rewrite</li>
<li>For convenience, we use the code layout<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// TabBar</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">reloadData</span><span class="params">()</span> </span>&#123;</span><br><span class="line">     <span class="keyword">this</span>. removeAllViews();</span><br><span class="line">     <span class="keyword">this</span>.initSeparatorLine(<span class="keyword">this</span>);</span><br><span class="line">     LinearLayout linearLayout = <span class="keyword">new</span> LinearLayout(HTRouteGlobal. activity);</span><br><span class="line">     <span class="keyword">this</span>.addView(linearLayout, HTRouteGlobal.matchParent);</span><br><span class="line">     linearLayout.setOrientation(LinearLayout.HORIZONTAL);</span><br><span class="line"></span><br><span class="line">     TypedValue typedValue = <span class="keyword">new</span> TypedValue();</span><br><span class="line">     <span class="keyword">int</span> imageId = android.R.attr.selectableItemBackground;</span><br><span class="line">     HTRouteGlobal.activity.getTheme().resolveAttribute(imageId, typedValue, <span class="keyword">true</span>);</span><br><span class="line">     <span class="keyword">int</span>[] attribute = <span class="keyword">new</span> <span class="keyword">int</span>[]&#123;imageId&#125;;</span><br><span class="line">     TypedArray typedArray = getContext().getTheme().obtainStyledAttributes(typedValue.resourceId, attribute);</span><br><span class="line"></span><br><span class="line">     <span class="keyword">for</span> (<span class="keyword">int</span> index = <span class="number">0</span>; index &lt; delegate. itemCount(); index ++) &#123;</span><br><span class="line">         ...</span><br><span class="line">         linearLayout. addView(relativeLayout);</span><br><span class="line">         reloadItemIndex(index);</span><br><span class="line"></span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="Encapsulate-TabBarController"><a href="#Encapsulate-TabBarController" class="headerlink" title="Encapsulate TabBarController"></a>Encapsulate TabBarController</h2><ul>
<li>For the Controller that has been covered by the top page, we need to move it out of the Fragment to save memory</li>
<li>And we need to handle viewDidAppear and viewDidDisappear lifecycle<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">didItemSelected</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">     HTRouteFragment fragment = modelList.get(index).fragment;</span><br><span class="line"></span><br><span class="line">     <span class="keyword">if</span> (fragmentContainer. getChildCount() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">         HTRouteFragment lastFragment = (HTRouteFragment) fragmentContainer.getChildAt(<span class="number">0</span>).getTag();</span><br><span class="line">         lastFragment. viewDidDisappear();</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">     View view = fragment. getView();</span><br><span class="line">     fragmentContainer. removeAllViews();</span><br><span class="line"></span><br><span class="line">     RelativeLayout.LayoutParams layoutParams = <span class="keyword">new</span> RelativeLayout.LayoutParams(ViewGroup.LayoutParams.MATCH_PARENT, ViewGroup.LayoutParams.MATCH_PARENT);</span><br><span class="line"></span><br><span class="line">     <span class="keyword">int</span> bottom = <span class="number">0</span>;</span><br><span class="line">     <span class="keyword">if</span> (!TextUtils.isEmpty(HTRouteGlobal.getProp(<span class="string">&quot;ro.build.version.emui&quot;</span>))) &#123;</span><br><span class="line">         bottom = <span class="number">1</span>;</span><br><span class="line">     &#125;</span><br><span class="line">     layoutParams.setMargins(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, bottom);</span><br><span class="line">     fragmentContainer.addView(view, layoutParams);</span><br><span class="line"></span><br><span class="line">     fragment. viewDidAppear();</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="Encapsulate-RouteView"><a href="#Encapsulate-RouteView" class="headerlink" title="Encapsulate RouteView"></a>Encapsulate RouteView</h2><p>The most important point is that we can bind the pages and parameters that need to be redirected to RouteView. When the original click event is received, we can directly jump to the native page without going through JS.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//HTRouteViewManager</span></span><br><span class="line"><span class="meta">@ReactProp(name = &quot;routeData&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRouteData</span><span class="params">(HTRouteView routeView, ReadableMap routeDataMap)</span> </span>&#123;</span><br><span class="line">     <span class="keyword">final</span> Map&lt;String, Object&gt; routeData = routeDataMap == <span class="keyword">null</span> ? <span class="keyword">null</span> : routeDataMap.toHashMap();</span><br><span class="line">     <span class="keyword">if</span> (routeData != <span class="keyword">null</span> &amp;&amp; routeData. size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">         routeView.setClickable(<span class="keyword">true</span>);</span><br><span class="line">         <span class="keyword">final</span> WeakReference&lt;HTRouteView&gt; weakRouteView = <span class="keyword">new</span> WeakReference&lt;&gt;(routeView);</span><br><span class="line">         routeView.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line">             <span class="meta">@Override</span></span><br><span class="line">             <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View view)</span> </span>&#123;</span><br><span class="line">                 touchRouteData(weakRouteView. get(), routeData);</span><br><span class="line">             &#125;</span><br><span class="line">         &#125;);</span><br><span class="line">     &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">         routeView.setClickable(<span class="keyword">false</span>);</span><br><span class="line">         routeView.setOnClickListener(<span class="keyword">null</span>);</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="All-page-jump-processing"><a href="#All-page-jump-processing" class="headerlink" title="All page jump processing"></a>All page jump processing</h2><p>Including push replace presentModal all common processing</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//HTRouteViewManager</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">handlerRouteDataWithController</span><span class="params">(HTRouteController controller, <span class="meta">@Nullable</span> Map&lt;String, Object&gt; routeData)</span> </span>&#123;</span><br><span class="line">     ...</span><br><span class="line">     <span class="keyword">if</span> (action. equals(<span class="string">&quot;push&quot;</span>) || action. equals(<span class="string">&quot;navigate&quot;</span>)) &#123;</span><br><span class="line">         ...</span><br><span class="line">         navigationController.pushViewController(routeController, animated, <span class="keyword">null</span>);</span><br><span class="line">     &#125; <span class="keyword">else</span> <span class="keyword">if</span> (action. equals(<span class="string">&quot;replace&quot;</span>)) &#123;</span><br><span class="line">         ...</span><br><span class="line">         navigationController. replaceViewController(routeController, animated);</span><br><span class="line">     &#125; <span class="keyword">else</span> <span class="keyword">if</span> (action. equals(<span class="string">&quot;pop&quot;</span>) || action. equals(<span class="string">&quot;back&quot;</span>) || action. equals(<span class="string">&quot;goBack&quot;</span>)) &#123;</span><br><span class="line">         navigationController. popViewController(animated);</span><br><span class="line">     &#125; <span class="keyword">else</span> <span class="keyword">if</span> (action. equals(<span class="string">&quot;popToTop&quot;</span>) || action. equals(<span class="string">&quot;popToRoot&quot;</span>)) &#123;</span><br><span class="line">         navigationController.popToRootViewControllerAnimated(animated);</span><br><span class="line">     &#125; <span class="keyword">else</span> <span class="keyword">if</span> (action. equals(<span class="string">&quot;present&quot;</span>)) &#123;</span><br><span class="line">         ...</span><br><span class="line">         presentView.addView(presentBackgroundView, HTRouteGlobal.matchParent);</span><br><span class="line">         translatePresentAnimation(presentBackgroundView, presentNavigationController.getView(), presentEdgeTop, <span class="keyword">true</span>, presentAnimatedDuration, <span class="keyword">new</span> Callback() &#123;</span><br><span class="line">             <span class="meta">@Override</span></span><br><span class="line">             <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">invoke</span><span class="params">(Object... args)</span> </span>&#123;</span><br><span class="line">                 presentNavigationController. viewDidAppear();</span><br><span class="line">             &#125;</span><br><span class="line">         &#125;);</span><br><span class="line">     &#125; <span class="keyword">else</span> <span class="keyword">if</span> (action. equals(<span class="string">&quot;dismiss&quot;</span>)) &#123;</span><br><span class="line">         <span class="keyword">final</span> RelativeLayout presentView = rootPresentViewController();</span><br><span class="line">         <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; presentView. getChildCount(); i ++) &#123;</span><br><span class="line">             <span class="keyword">final</span> ViewGroup presentBackgroundView = (ViewGroup) presentView. getChildAt(i);</span><br><span class="line">             View navigationControllerView = presentBackgroundView. getChildAt(<span class="number">0</span>);</span><br><span class="line">             <span class="keyword">final</span> HTRouteNavigationController presentNavigationController = HTRouteGlobal.nextController(navigationControllerView, HTRouteNavigationController.class);</span><br><span class="line">             HTRouteController routeController = presentNavigationController. childControllerList. get(<span class="number">0</span>);</span><br><span class="line">             <span class="keyword">if</span> (routeController. componentName. equals(componentName)) &#123;</span><br><span class="line">                 translatePresentAnimation(presentBackgroundView, presentNavigationController.getView(), presentEdgeTop, <span class="keyword">false</span>, presentAnimatedDuration, <span class="keyword">new</span> Callback() &#123;</span><br><span class="line">                     <span class="meta">@Override</span></span><br><span class="line">                     <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">invoke</span><span class="params">(Object... args)</span> </span>&#123;</span><br><span class="line">                         presentView. removeView(presentBackgroundView);</span><br><span class="line">                         presentNavigationController. viewDidDisappear();</span><br><span class="line">                         presentNavigationController. dealloc();</span><br><span class="line">                     &#125;</span><br><span class="line">                 &#125;);</span><br><span class="line">             &#125;</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Same-interface-as-react-navigation"><a href="#Same-interface-as-react-navigation" class="headerlink" title="Same interface as react-navigation"></a>Same interface as react-navigation</h2><p>We need to leave the same interface as react-navigation on the JS side to facilitate switching at any time</p>
<h3 id="JS-parameter-passing"><a href="#JS-parameter-passing" class="headerlink" title="JS parameter passing"></a>JS parameter passing</h3><p>If function parameters need to be passed between pages, we need to store these variables in global variables, and then retrieve them through the key on the second page, because functions cannot be serialized</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="keyword">const</span> encodeRouteData = <span class="function">(<span class="params">routeData, navigation</span>) =&gt;</span> &#123;</span><br><span class="line">     <span class="keyword">let</span> reloadRouteData = &#123; ...routeData &#125;</span><br><span class="line">     <span class="keyword">let</span> componentName = reloadRouteData?.componentName</span><br><span class="line">     <span class="keyword">let</span> componentPropList = reloadRouteData?. componentPropList ?? &#123;&#125;</span><br><span class="line">     <span class="keyword">let</span> componentRouteOptionList = reloadRouteData?. componentRouteOptionList ?? &#123;&#125;</span><br><span class="line">     componentRouteOptionList = &#123;</span><br><span class="line">         ...HTRouteManager. defaultRouteOption(&#123; ...routeData, navigation &#125;),</span><br><span class="line">         ...componentRouteOptionList,</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="keyword">if</span> (<span class="keyword">typeof</span>(componentName) == <span class="string">&#x27;string&#x27;</span> &amp;&amp; !globalValue.registerList[componentName]) &#123;</span><br><span class="line">         <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">     <span class="keyword">let</span> id = componentRouteOptionList[<span class="string">&#x27;id&#x27;</span>]</span><br><span class="line">     <span class="keyword">if</span> (id == <span class="literal">null</span>) &#123;</span><br><span class="line">         globalValue.count += <span class="number">1</span></span><br><span class="line">         id = <span class="string">`<span class="subst">$&#123;globalValue.count&#125;</span>`</span></span><br><span class="line">     &#125;</span><br><span class="line">     componentRouteOptionList[<span class="string">&#x27;id&#x27;</span>] = id</span><br><span class="line"></span><br><span class="line">     reloadRouteData[<span class="string">&#x27;componentRouteOptionList&#x27;</span>] = componentRouteOptionList</span><br><span class="line"></span><br><span class="line">     sureComponentItem(id, &#123; componentPropList &#125;)</span><br><span class="line"></span><br><span class="line">     <span class="keyword">return</span> reloadRouteData</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> decodeRouteData = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">     <span class="keyword">let</span> reloadProps = &#123; ... props &#125;</span><br><span class="line">     <span class="keyword">let</span> componentRouteOptionList = reloadProps?. componentRouteOptionList ?? &#123;&#125;</span><br><span class="line">     <span class="keyword">let</span> id = componentRouteOptionList?.id</span><br><span class="line">     sureComponentItem(id)</span><br><span class="line"></span><br><span class="line">     <span class="keyword">let</span> componentValueList = globalValue. componentList[id] ?? &#123;&#125;</span><br><span class="line">     <span class="keyword">let</span> componentPropList = componentValueList[<span class="string">&#x27;componentPropList&#x27;</span>] ?? &#123;&#125;</span><br><span class="line">     reloadProps.componentPropList = componentPropList</span><br><span class="line">     <span class="keyword">return</span> reloadProps</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="JS-Lifecycle"><a href="#JS-Lifecycle" class="headerlink" title="JS Lifecycle"></a>JS Lifecycle</h3><p>We need to receive the viewDidAppear and viewDidDisappear life cycle events sent by the native side, and then call the method of the corresponding component through the id</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="keyword">const</span> routeListener = HTRouteEventManagerEmitter. addListener(<span class="string">&#x27;onHTRouteEventChange&#x27;</span>, <span class="function">(<span class="params">value</span>) =&gt;</span> &#123;</span><br><span class="line">     <span class="keyword">let</span> id = value[<span class="string">&#x27;id&#x27;</span>]</span><br><span class="line">     <span class="keyword">let</span> actionName = value[<span class="string">&#x27;actionName&#x27;</span>]</span><br><span class="line">     <span class="keyword">let</span> componentRef = globalValue.componentList[id]?.ref</span><br><span class="line">     <span class="keyword">if</span> (componentRef == <span class="literal">null</span>) &#123;</span><br><span class="line">         <span class="keyword">return</span></span><br><span class="line">     &#125;</span><br><span class="line">     DeviceEventEmitter. emit(<span class="string">&#x27;onHTRouteEvent&#x27;</span>, &#123; <span class="attr">title</span>: <span class="string">&#x27;controller&#x27;</span>, <span class="attr">value</span>: value &#125;)</span><br><span class="line"></span><br><span class="line">     <span class="keyword">if</span> (value?. actionName == <span class="string">&#x27;dealloc&#x27;</span>) &#123;</span><br><span class="line">         globalValue.componentList[id].ref = <span class="literal">null</span></span><br><span class="line">         <span class="keyword">return</span></span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">     <span class="keyword">let</span> componentFunction = componentRef[actionName]</span><br><span class="line">     <span class="keyword">if</span> (componentFunction == <span class="literal">null</span>) &#123;</span><br><span class="line">         <span class="keyword">return</span></span><br><span class="line">     &#125;</span><br><span class="line">     componentFunction. call(componentRef, value)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="Affiliated"><a href="#Affiliated" class="headerlink" title="Affiliated"></a>Affiliated</h2><p>The full code is here <a target="_blank" rel="noopener" href="https://github.com/hellohublot/react-native-route">https://github.com/hellohublot/react-native-route</a><br>I’m hublot, sharing some of my thoughts, I’m too busy with work, it’s inevitable that there will be negligence, please forgive me</p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/ReactNative/" rel="tag"># ReactNative</a>
              <a href="/tags/Performance/" rel="tag"># Performance</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2022/02/23/Analyzing%20and%20optimizing%20ReactNative%20animations%20and%20gestures%20through%20source%20code/" rel="prev" title="Analyzing and optimizing ReactNative animations and gestures through source code">
      <i class="fa fa-chevron-left"></i> Analyzing and optimizing ReactNative animations and gestures through source code
    </a></div>
      <div class="post-nav-item">
    <a href="/2022/04/23/How%20to%20use%20ReactNative%20to%20implement%20a%20high-performance%20navigation%20bar/" rel="next" title="How to use ReactNative to implement a high-performance navigation bar">
      How to use ReactNative to implement a high-performance navigation bar <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Where-is-the-performance-bottleneck-of-react-navigation"><span class="nav-number">1.</span> <span class="nav-text">Where is the performance bottleneck of react-navigation</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Encapsulate-NavigationController"><span class="nav-number">2.</span> <span class="nav-text">Encapsulate NavigationController</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Package-TabBar"><span class="nav-number">3.</span> <span class="nav-text">Package TabBar</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Encapsulate-TabBarController"><span class="nav-number">4.</span> <span class="nav-text">Encapsulate TabBarController</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Encapsulate-RouteView"><span class="nav-number">5.</span> <span class="nav-text">Encapsulate RouteView</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#All-page-jump-processing"><span class="nav-number">6.</span> <span class="nav-text">All page jump processing</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Same-interface-as-react-navigation"><span class="nav-number">7.</span> <span class="nav-text">Same interface as react-navigation</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#JS-parameter-passing"><span class="nav-number">7.1.</span> <span class="nav-text">JS parameter passing</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#JS-Lifecycle"><span class="nav-number">7.2.</span> <span class="nav-text">JS Lifecycle</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Affiliated"><span class="nav-number">8.</span> <span class="nav-text">Affiliated</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="hublot@aliyun.com"
      src="/images/avatar.gif">
  <p class="site-author-name" itemprop="name">hublot@aliyun.com</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">4</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/hellohublot" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;hellohublot" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:hublot@aliyun.com" title="E-Mail → mailto:hublot@aliyun.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">hublot@aliyun.com</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
